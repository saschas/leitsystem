function init(){camera=new THREE.PerspectiveCamera(15,window.innerWidth/window.innerHeight,1,1e4),camera.position.set(0,800,1e3),controls=new THREE.OrbitControls(camera),controls.rotateSpeed=1,controls.zoomSpeed=1.2,controls.panSpeed=.8,controls.noZoom=!1,controls.noPan=!1,controls.staticMoving=!0,controls.dynamicDampingFactor=.3,scene=new THREE.Scene,scene.add(new THREE.AmbientLight(5263440));var e=new THREE.SpotLight(16777215,1.5);e.position.set(0,1e3,2500),e.castShadow=!0,e.shadowCameraNear=500,e.shadowCameraFar=camera.far,e.shadowCameraFov=50,e.shadowBias=-22e-5,e.shadowDarkness=.5,e.shadowMapWidth=2048,e.shadowMapHeight=2048,scene.add(e);var n={x:50,y:50,size:20,margin:1.01};plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(2e3,2e3,8,8),new THREE.MeshBasicMaterial({color:0,opacity:.25,transparent:!0})),plane.visible=!1,scene.add(plane),renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setClearColor(15790320),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.sortObjects=!1,renderer.shadowMapEnabled=!0,renderer.shadowMapType=THREE.PCFShadowMap,document.body.appendChild(renderer.domElement),renderer.domElement.addEventListener("mousemove",onDocumentMouseMove,!1),renderer.domElement.addEventListener("mousedown",onDocumentMouseDown,!1),renderer.domElement.addEventListener("mouseup",onDocumentMouseUp,!1),renderer.domElement.addEventListener("contextmenu",onContextMenu),window.addEventListener("resize",onWindowResize,!1)}function cuber(e,n){}function onContextMenu(e){eX=e.pageX,eY=e.pageY}function add_new_Object(e){if("box"==e.type){var n=new THREE.Mesh(e.geometry,new THREE.MeshBasicMaterial({color:16711680}));n.position.y=5,n.scale.set(1,10,1),objects.push(n),n.options=e,scene.add(n)}"schrank"==e.type&&(e.geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,5,0)),loader.load("model/hirsch.js",function(n){console.log(n);var o=new THREE.MeshBasicMaterial({color:0,opacity:.25,transparent:!0}),t=new THREE.Mesh(n,o);t.scale.set(20,20,20),t.position.set(0,0,0),objects.push(t),t.options=e,scene.add(t)}))}function drawShape(e){var n=transformSVGPathExposed(e.attr("d"));return n}function createMesh(e){e.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,0));var n=THREE.SceneUtils.createMultiMaterialObject(e,[meshMaterial]);return n.rotation.z=90*Math.PI/180,n}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(e){if(e.preventDefault(),mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=2*-(e.clientY/window.innerHeight)+1,raycaster.setFromCamera(mouse,camera),SELECTED){var n=raycaster.intersectObject(plane);return SELECTED.position.copy(n[0].point.sub(offset)),void(SELECTED.position.y=0)}var n=raycaster.intersectObjects(objects);n.length>0?(INTERSECTED!=n[0].object&&(INTERSECTED&&INTERSECTED.material.color.setHex(INTERSECTED.currentHex),INTERSECTED=n[0].object,INTERSECTED.currentHex=INTERSECTED.material.color.getHex(),plane.position.copy(INTERSECTED.position),plane.lookAt(camera.position)),document.body.style.cursor="pointer"):(INTERSECTED&&INTERSECTED.material.color.setHex(INTERSECTED.currentHex),INTERSECTED=null,document.body.style.cursor="auto")}function onDocumentMouseDown(e){e.preventDefault();var n=new THREE.Vector3(mouse.x,mouse.y,.5).unproject(camera),o=new THREE.Raycaster(camera.position,n.sub(camera.position).normalize()),t=o.intersectObjects(objects);if(t.length>0){controls.enabled=!1,SELECTED=t[0].object;var t=o.intersectObject(plane);offset.copy(t[0].point).sub(plane.position),$(".object-menu").addClass("open").css({transform:"translateX("+e.pageX+"px) translateY("+e.pageY+"px)"}),t[0].object.material.color.r=1,console.log(SELECTED.options),document.body.style.cursor="move"}}function onDocumentMouseUp(e){e.preventDefault(),controls.enabled=!0,INTERSECTED&&(plane.position.copy(INTERSECTED.position),SELECTED=null),document.body.style.cursor="auto"}function animate(){requestAnimationFrame(animate),render()}function render(){controls.update(),renderer.render(scene,camera)}var container,stats,camera,controls,scene,renderer,objects=[],plane,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,offset=new THREE.Vector3,INTERSECTED,SELECTED,output={size:{x:1,y:1}},object_options={type:null,position:{vec:null,x:null,y:null,z:null},clickable:!0,active_material:new THREE.MeshBasicMaterial({color:65280}),geometry:new THREE.BoxGeometry(10,10,10),extra:{href:"http://www.google.de/",description:"Dieser Gegenstand hat eine Beschreibung"}};init(),animate();var geometry=new THREE.PlaneGeometry(window.innerWidth,window.innerHeight,32),material=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,map:THREE.ImageUtils.loadTexture("raumplan.png")}),floor=new THREE.Mesh(geometry,material);floor.rotation.x=90*Math.PI/180,floor.position.y=5,floor.receiveShadow=!0,scene.add(floor);var loader=new THREE.JSONLoader,options={amount:2,bevelThickness:0,bevelSize:0,bevelSegments:0,bevelEnabled:!1,curveSegments:0,steps:1},meshMaterial=new THREE.MeshPhongMaterial({specular:16777215,color:4473924,shininess:100,metal:!0}),grundriss_holder=new THREE.Object3D;$(".st0").each(function(){shape=createMesh(new THREE.ExtrudeGeometry(drawShape($(this)),options)),grundriss_holder.add(shape)}),grundriss_holder.scale.set(1,1,20),grundriss_holder.rotation.x=90*Math.PI/180,grundriss_holder.position.y=50,grundriss_holder.position.x=300,scene.add(grundriss_holder),$(".item").click(function(){var e=$(this).attr("data-type");console.log(e),"box"==e&&(object_options.type=e),"schrank"==e&&(object_options.type=e),"export"==e?console.log("All Objects",objects):add_new_Object(object_options)}),$("canvas").bind({mouseenter:function(){controls.enabled=!0,$(".open").removeClass("open")},mouseout:function(){controls.enabled=!1}});